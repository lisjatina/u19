<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><link href="../../../../../doc/style.css?colorTheme=Custom.OdoTheme" rel="stylesheet" type="text/css" media="all"></head><body><html><head><script>/*<![CDATA[*/</body></html>
</body></html>
document.observe("dom:loaded", function() {</body></html>
if(getCookie('recipeInfo') == 'hide')</body></html>
hideRecipeInfo();</body></html>
else</body></html>
showRecipeInfo();</body></html>
});</body></html>
/*]]>*/</script></head><body><div id="recipeInfo"><div class="box warningmessage"><p>If it is not explicitly told in following recipe, setting up services are described for <span class="wikilink"><a href="https://odo.lv/Recipes/UbuntuSetupSrv">Ubuntu <strong>16.04</strong> server</a></span>, but applications are described for <span class="wikilink"><a href="https://odo.lv/Recipes/UbuntuSetup">Ubuntu <strong>16.04</strong></a></span> and/or <span class="wikilink"><a href="https://odo.lv/Recipes/LubuntuSetup">Lubuntu <strong>16.04</strong></a></span> workstation. If you use different Ubuntu version or Linux distribution, settings as well as content, names and places of configuration files may be different!<br><a onclick="hideRecipeInfo()">Got it.</a></p></div></div><div id="showRecipeInfo" class="hidden memo"><p><a onclick="showRecipeInfo()">Show general information.</a></p></div><h1 id="HExtra12.JavaNativeInterface" class="wikigeneratedid wikigeneratedheader"><span>Extra 12. Java Native Interface</span></h1><div></div><p></p><ol><li><div><p>Review <span class="wikiinternallink"><a href="https://odo.lv/git/JTM/plain/doc/presentations/e12_JNI.odp">presentation</a></span></p><video src="https://odo.lv/ftp/lectures/Javae12.ogv" width="300" controls></body></html>
<a href="https://odo.lv/ftp/lectures/Javae12.ogv">Javae12.ogv</a></body></html>
</video></div></li></ol><ol><li>To add support for C development in Eclipse, install <strong>Eclipse CDT</strong> plugin, which you can search in Eclipse Marketplace by entering <strong>cdt</strong>.</li><li>Review content of <strong>jtm.extra12</strong> package and <strong>src/main/c/jnifunctions.c</strong> file.</li><li><div><p>Install GNU C compiler:</p><div class="box"><div class="code">sudo apt-get update<br>sudo apt-get install gcc</div></div></div></li><li>Implement TODO's for <strong>JNIClass.java</strong> class and <strong>jnifunctions.c</strong> file.</li><li><div><p>Compile <strong>JNIClass.java</strong> file considering classpath and target location:</p><div class="box"><div class="code">javac -cp target/classes -d target/classes src/main/java/jtm/extra12/JNIClass.java</div></div></div></li><li><div><p>Generate <strong>jtm_extra12_JNIClass.h</strong> file in lib folder:</p><div class="box"><div class="code">javac -cp target/classes -h lib/ src/main/java/jtm/extra12/JNIClass.java</div></div><p>This file will be located in <span class="wikimodel-verbatim">lib</span> folder of the project.</p></div></li><li>Check that list of methods is generated in <span class="wikimodel-verbatim">jtm_extra12_JNIClass.h</span> file.</li><li><div><p>Implement generated interfaces from <span class="wikimodel-verbatim">lib/jtm_extra12_JNIClass.h</span> file in <span class="wikimodel-verbatim">/src/main/c/jnifunctions.c</span> file:</p><div class="box"><div class="code">JNIEXPORT void JNICALL Java_jtm_extra12_JNIClass_printHello(JNIEnv * env, jclass class) {<br>	// TODO call printHello();<br>}<br><br>JNIEXPORT void JNICALL Java_jtm_extra12_JNIClass_printArray<br>(JNIEnv * env, jobject obj, jstring string) {<br>        // TODO #1: convert jstring to array of C chars<br>        // TODO #2: call printArray(yourarray);<br>        // TODO #3: release resourches for passed jstring<br>}<br><br>JNIEXPORT jstring JNICALL Java_jtm_extra12_JNIClass_createArray(JNIEnv * env,<br>		jobject obj, jint size) {<br>        // TODO #1: call createArray(size);<br>        // TODO #2: convert created array of C chars to jstring<br>        // TODO #3: return jstring<br>}</div></div></div></li><li><div><p>Compile <strong>jnifunctions.c</strong> file including JNI libraries for 64-bit Linux:</p><div class="box"><div class="code">gcc -fPIC -I/usr/lib/jvm/java-11-openjdk-amd64/include \<br>-I/usr/lib/jvm/java-11-openjdk-amd64/include/linux \<br>./src/main/c/jnifunctions.c -c -o ./lib/jnifunctions.o</div></div></div></li><li><div><p>Make shared library for Linux:</p><div class="box"><div class="code">gcc -shared ./lib/jnifunctions.o -o ./lib/jnifunctions.so</div></div></div></li><li><div><p>Test application by calling its main() method:</p><div class="box"><div class="code">java -cp target/classes/ jtm.extra12.JNIClass</div></div></div></li><li>Ensure <strong>JNIClassTest1.java</strong> unit tests are passing.</li></ol><h2 id="HOptionaltasks" class="wikigeneratedid"><span>Optional tasks</span></h2><ol><li><div><p>You can compile jnifunctions.c as independent executable with following parameters:</p><div class="box"><div class="code">gcc -I/usr/lib/jvm/java-11-openjdk-amd64/include \<br>-I/usr/lib/jvm/java-11-openjdk-amd64/include/linux \<br>./src/main/c/jnifunctions.c -o ./lib/hello.o</div></div></div></li><li><div><p>Then execute created binary by:</p><div class="box"><div class="code">./lib/hello.o</div></div></div></li></ol><h2 id="HLinks" class="wikigeneratedid"><span>Links</span></h2><ul><li><span class="wikiexternallink"><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/jniTOC.html">Java Native Interface Specification</a></span></li><li><span class="wikiexternallink"><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/functions.html">JNI Functions</a></span></li></ul><h2 id="HAlternatives" class="wikigeneratedid"><span>Alternatives</span></h2><ul><li><span class="wikiexternallink"><a href="https://en.wikipedia.org/wiki/Java_Native_Access">Java Native Access (JNA)</a></span></li></ul><br>  </body></html></body></html>